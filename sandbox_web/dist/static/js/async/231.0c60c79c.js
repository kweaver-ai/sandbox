"use strict";(self.webpackChunksandbox_web=self.webpackChunksandbox_web||[]).push([["231"],{5182(e,t,i){i.d(t,{I7:()=>c,Xu:()=>o,ub:()=>a,$F:()=>n,eG:()=>s});var r=i(4608),l=i(3232);function s(e){return(0,l.Jt)(r.Sn.TEMPLATES,{params:{...r.nS,...e}})}function n(e){return(0,l.Jt)(r.Sn.TEMPLATE(e))}function o(e){return(0,l.bE)(r.Sn.TEMPLATES,e)}function a(e,t){return(0,l.yJ)(r.Sn.TEMPLATE(e),t)}function c(e){return(0,l.yH)(r.Sn.TEMPLATE(e))}},4608(e,t,i){i.d(t,{JR:()=>r,Sn:()=>l,nS:()=>s});let r="http://localhost:8000",l={HEALTH:"/api/v1/health",HEALTH_DETAILED:"/api/v1/health/detailed",TEMPLATES:"/api/v1/templates",TEMPLATE:e=>`/api/v1/templates/${e}`,SESSIONS:"/api/v1/sessions",SESSION:e=>`/api/v1/sessions/${e}`,EXECUTE:e=>`/api/v1/executions/sessions/${e}/execute`,EXECUTION_STATUS:e=>`/api/v1/executions/${e}/status`,EXECUTION_RESULT:e=>`/api/v1/executions/${e}/result`,EXECUTIONS_BY_SESSION:e=>`/api/v1/executions/sessions/${e}/executions`,UPLOAD_FILE:e=>`/api/v1/sessions/${e}/files/upload`,DOWNLOAD_FILE:(e,t)=>`/api/v1/sessions/${e}/files/${t}`},s={LIMIT:50,OFFSET:0}},4372(e,t,i){i.d(t,{Gw:()=>l,iZ:()=>r,iu:()=>n,mx:()=>s});let r={"python3.11":"Python 3.11",nodejs20:"Node.js 20",java17:"Java 17","go1.21":"Go 1.21"},l={PENDING:"等待中",CREATING:"创建中",STARTING:"启动中",RUNNING:"运行中",COMPLETED:"已完成",TERMINATED:"已终止",FAILED:"失败",TIMEOUT:"超时"},s={PENDING:"等待中",RUNNING:"执行中",COMPLETED:"成功",FAILED:"失败",TIMEOUT:"超时",CRASHED:"崩溃"},n={CPU:["0.5","1","2","4"],MEMORY:["128Mi","256Mi","512Mi","1Gi","2Gi","4Gi","8Gi"],DISK:["256Mi","512Mi","1Gi","5Gi","10Gi","20Gi","50Gi"]}},3803(e,t,i){i.d(t,{t:()=>o});var r=i(6540),l=i(7959),s=i(4608),n=i(3232);function o(){let[e,t]=(0,r.useState)([]),[i,o]=(0,r.useState)(!1),a=(0,r.useRef)(!1),c={total:e.length,starting:e.filter(e=>"CREATING"===e.status||"creating"===e.status||"STARTING"===e.status||"starting"===e.status).length,running:e.filter(e=>"RUNNING"===e.status||"running"===e.status).length,terminated:e.filter(e=>"TERMINATED"===e.status||"terminated"===e.status||"COMPLETED"===e.status||"completed"===e.status).length},d=(0,r.useCallback)(async()=>{if(!a.current){a.current=!0,o(!0);try{let e=await (0,n.Jt)(s.Sn.SESSIONS,{params:void 0});t(e.items)}catch(e){l.Ay.error("获取会话列表失败"),console.error(e)}finally{a.current=!1,o(!1)}}},[]);return{sessions:e,stats:c,loading:i,fetchSessions:d,createSession:(0,r.useCallback)(async e=>{o(!0);try{let i=await (0,n.bE)(s.Sn.SESSIONS,e);return t(e=>[...e,i]),l.Ay.success("会话创建成功"),i}catch(e){throw l.Ay.error("会话创建失败"),console.error(e),e}finally{o(!1)}},[]),terminateSession:(0,r.useCallback)(async e=>{o(!0);try{let i=await (0,n.yH)(s.Sn.SESSION(e));return t(t=>t.map(t=>t.id===e?i:t)),l.Ay.success("会话已终止"),i}catch(e){throw l.Ay.error("会话终止失败"),console.error(e),e}finally{o(!1)}},[])}}},711(e,t,i){i.d(t,{b:()=>n});var r=i(6540),l=i(7959),s=i(5182);function n(){let[e,t]=(0,r.useState)([]),[i,n]=(0,r.useState)(!1),o=(0,r.useCallback)(async()=>{n(!0);try{let e=await s.eG();t(e)}catch(e){l.Ay.error("获取模板列表失败"),console.error(e)}finally{n(!1)}},[]),a=(0,r.useCallback)(async e=>{n(!0);try{let i=await s.Xu(e);return t(e=>[...e,i]),l.Ay.success("模板创建成功"),i}catch(e){throw l.Ay.error("模板创建失败"),console.error(e),e}finally{n(!1)}},[]);return{templates:e,loading:i,fetchTemplates:o,createTemplate:a,updateTemplate:(0,r.useCallback)(async(e,i)=>{n(!0);try{let r=await s.ub(e,i);return t(t=>t.map(t=>t.id===e?r:t)),l.Ay.success("模板更新成功"),r}catch(e){throw l.Ay.error("模板更新失败"),console.error(e),e}finally{n(!1)}},[]),deleteTemplate:(0,r.useCallback)(async e=>{n(!0);try{await s.I7(e),t(t=>t.filter(t=>t.id!==e)),l.Ay.success("模板删除成功")}catch(e){throw l.Ay.error("模板删除失败"),console.error(e),e}finally{n(!1)}},[])}}},8266(e,t,i){i.r(t),i.d(t,{default:()=>_});var r=i(4848),l=i(6540),s=i(7767),n=i(3543),o=i(7959),a=i(5196),c=i(3133),d=i(697),u=i(7073),m=i(9405),y=i(7486),p=i(5658),h=i(3852),x=i(5801),j=i(2880),A=i(5723),f=i(7532),g=i(8237),S=i(1750),T=i(6089),E=i(4811),v=i(8623),I=i(3803),b=i(711),w=i(4372),N=i(4608),C=i(8371);async function G(e,t,i){let r=new FormData;r.append("file",t);let l=i||t.name;return(await C.A.post(N.Sn.UPLOAD_FILE(e),r,{params:{path:l},headers:{"Content-Type":void 0}})).data}function _(){let e=(0,s.Zp)(),{sessions:t,stats:i,loading:N,fetchSessions:C,createSession:_,terminateSession:D}=(0,I.t)(),{templates:R,fetchTemplates:O}=(0,b.b)(),[M,L]=(0,l.useState)(""),[k,z]=(0,l.useState)(!1),[P,U]=(0,l.useState)(null),[B,F]=(0,l.useState)(!1),[$,q]=(0,l.useState)([]),[J,H]=(0,l.useState)(""),[X]=n.A.useForm(),[V,Z]=(0,l.useState)(!1),[K,Y]=(0,l.useState)(""),[W,Q]=(0,l.useState)(""),[ee,et]=(0,l.useState)(""),[ei,er]=(0,l.useState)([]),[el,es]=(0,l.useState)(!1),en=(0,l.useRef)(null);(0,l.useEffect)(()=>(C(),en.current=setInterval(()=>{C()},3e4),()=>{en.current&&clearInterval(en.current)}),[C]);let eo=async()=>{await O(),z(!0)},ea=t=>{e(`/execute?sessionId=${t}`)},ec=t.filter(e=>e.id.toLowerCase().includes(M.toLowerCase())||e.template_id.toLowerCase().includes(M.toLowerCase())),ed=async()=>{try{let e={...await X.validateFields(),dependencies:J.split("\n").filter(e=>e.trim()).map(e=>{var t,i;let r=e.trim().split(/==|>=|<=|>|~/),l=null==(t=r[0])?void 0:t.trim(),s=null==(i=r[1])?void 0:i.trim();return{name:l,version:s}}).filter(e=>e.name)};await _(e),z(!1),X.resetFields(),H(""),q([])}catch(e){}},eu=async e=>{try{await D(e)}catch(e){}},em=async()=>{if(0===ei.length)return void o.Ay.warning("请选择要上传的文件");es(!0);try{for(let e of ei)if(e.originFileObj){let t=ee||e.name;await G(K,e.originFileObj,t)}o.Ay.success("文件上传成功"),er([]),et(""),Z(!1)}catch(e){o.Ay.error("文件上传失败"),console.error(e)}finally{es(!1)}},ey=e=>{let t={PENDING:{color:"warning",icon:"⏱",label:w.Gw.PENDING},CREATING:{color:"processing",icon:"\uD83D\uDD04",label:w.Gw.CREATING},STARTING:{color:"processing",icon:"\uD83D\uDD04",label:w.Gw.STARTING},RUNNING:{color:"processing",icon:"⚡",label:w.Gw.RUNNING},COMPLETED:{color:"success",icon:"✓",label:w.Gw.COMPLETED},TERMINATED:{color:"default",icon:"⏹",label:w.Gw.TERMINATED},FAILED:{color:"error",icon:"✗",label:w.Gw.FAILED},TIMEOUT:{color:"error",icon:"⏱",label:w.Gw.TIMEOUT},pending:{color:"warning",icon:"⏱",label:w.Gw.PENDING},creating:{color:"processing",icon:"\uD83D\uDD04",label:w.Gw.CREATING},starting:{color:"processing",icon:"\uD83D\uDD04",label:w.Gw.STARTING},running:{color:"processing",icon:"⚡",label:w.Gw.RUNNING},completed:{color:"success",icon:"✓",label:w.Gw.COMPLETED},terminated:{color:"default",icon:"⏹",label:w.Gw.TERMINATED},failed:{color:"error",icon:"✗",label:w.Gw.FAILED},timeout:{color:"error",icon:"⏱",label:w.Gw.TIMEOUT}};return t[e]||t.PENDING},ep=[{title:"会话ID",dataIndex:"id",key:"id",width:180,render:e=>(0,r.jsx)("code",{children:e})},{title:"模版ID",dataIndex:"template_id",key:"template_id",width:180},{title:"状态",dataIndex:"status",key:"status",width:120,render:e=>{let t=ey(e);return(0,r.jsxs)(a.A,{color:t.color,children:[t.icon," ",t.label]})}},{title:"资源配置",key:"resources",width:200,render:(e,t)=>t.resource_limit?`${t.resource_limit.cpu}核 / ${t.resource_limit.memory} / ${t.resource_limit.disk}`:"-"},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180},{title:"操作",key:"action",width:150,fixed:"right",render:(e,t)=>{let i="running"===t.status||"RUNNING"===t.status||"creating"===t.status||"CREATING"===t.status||"starting"===t.status||"STARTING"===t.status;return(0,r.jsxs)(c.A,{size:"small",children:[(0,r.jsx)(d.Ay,{type:"text",icon:(0,r.jsx)(f.A,{}),size:"small",title:"查看详情",onClick:()=>{U(t),F(!0)}}),(0,r.jsx)(d.Ay,{type:"text",icon:(0,r.jsx)(g.A,{}),size:"small",title:"上传文件",onClick:()=>{Y(t.id),Q(t.id),Z(!0)},disabled:"terminated"===t.status||"TERMINATED"===t.status||"completed"===t.status||"COMPLETED"===t.status}),(0,r.jsx)(d.Ay,{type:"text",icon:(0,r.jsx)(S.A,{}),size:"small",title:"执行代码",onClick:()=>ea(t.id),disabled:"terminated"===t.status||"TERMINATED"===t.status||"completed"===t.status||"COMPLETED"===t.status||"failed"===t.status||"FAILED"===t.status||"timeout"===t.status||"TIMEOUT"===t.status}),i&&(0,r.jsx)(u.A,{title:"确认终止",description:"确定要终止该会话吗？",onConfirm:()=>eu(t.id),okText:"确定",cancelText:"取消",children:(0,r.jsx)(d.Ay,{type:"text",danger:!0,icon:(0,r.jsx)(T.A,{}),size:"small",title:"终止会话"})})]})}}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,r.jsx)("div",{style:{width:2,height:18,backgroundColor:"#126ee3",borderRadius:4,marginRight:8}}),(0,r.jsx)("h2",{style:{fontSize:15,fontWeight:500,margin:0,color:"#000000"},children:"会话管理"})]}),(0,r.jsx)("p",{style:{fontSize:13,color:"#677489",marginLeft:12,marginTop:0,marginBottom:0},children:"创建和管理代码执行会话"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:24},children:[(0,r.jsx)(m.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,r.jsx)(y.A,{title:"总会话数（个）",value:i.total})}),(0,r.jsx)(m.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,r.jsx)(y.A,{title:"启动中（个）",value:i.starting,valueStyle:{color:"#faad14"}})}),(0,r.jsx)(m.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,r.jsx)(y.A,{title:"运行中（个）",value:i.running,valueStyle:{color:"#126ee3"}})}),(0,r.jsx)(m.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,r.jsx)(y.A,{title:"已终止（个）",value:i.terminated,valueStyle:{color:"#8c8c8c"}})})]}),(0,r.jsxs)("div",{style:{backgroundColor:"#ffffff",borderRadius:12,border:"1px solid #e7edf7",padding:24},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24},children:[(0,r.jsx)(p.A,{placeholder:"搜索会话ID或模版ID",prefix:(0,r.jsx)(E.A,{}),value:M,onChange:e=>L(e.target.value),style:{width:320},allowClear:!0}),(0,r.jsx)(d.Ay,{type:"primary",icon:(0,r.jsx)(v.A,{}),onClick:eo,children:"创建会话"})]}),(0,r.jsx)(h.A,{columns:ep,dataSource:ec,rowKey:"id",loading:N,pagination:{pageSize:10},scroll:{x:1200}})]}),(0,r.jsx)(x.A,{title:"创建新会话",open:k,onOk:ed,onCancel:()=>{z(!1),X.resetFields(),H(""),q([])},width:600,okText:"创建",cancelText:"取消",children:(0,r.jsxs)(n.A,{form:X,layout:"vertical",style:{marginTop:24},children:[(0,r.jsx)(n.A.Item,{name:"template_id",label:"选择模版",rules:[{required:!0,message:"请选择模版"}],children:(0,r.jsx)(j.A,{placeholder:"请选择模版",onChange:e=>{let t=R.find(t=>t.id===e);t&&X.setFieldsValue({cpu:t.default_cpu_cores.toString(),memory:`${t.default_memory_mb}Mi`,disk:`${t.default_disk_mb}Mi`,timeout:t.default_timeout_sec})},children:R.filter(e=>e.is_active).map(e=>(0,r.jsxs)(j.A.Option,{value:e.id,children:[e.name," (",w.iZ[e.runtime_type]||e.runtime_type,")"]},e.id))})}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,r.jsx)(n.A.Item,{name:"cpu",label:"CPU",rules:[{required:!0,message:"请输入CPU"}],initialValue:"1",children:(0,r.jsx)(j.A,{placeholder:"例如: 1, 2",children:w.iu.CPU.map(e=>(0,r.jsxs)(j.A.Option,{value:e,children:[e," 核"]},e))})}),(0,r.jsx)(n.A.Item,{name:"memory",label:"内存",rules:[{required:!0,message:"请输入内存"}],initialValue:"512Mi",children:(0,r.jsx)(j.A,{placeholder:"例如: 512Mi, 1Gi",children:w.iu.MEMORY.map(e=>(0,r.jsx)(j.A.Option,{value:e,children:e},e))})}),(0,r.jsx)(n.A.Item,{name:"disk",label:"磁盘",rules:[{required:!0,message:"请输入磁盘"}],initialValue:"1Gi",children:(0,r.jsx)(j.A,{placeholder:"例如: 1Gi, 10Gi",children:w.iu.DISK.map(e=>(0,r.jsx)(j.A.Option,{value:e,children:e},e))})}),(0,r.jsx)(n.A.Item,{name:"timeout",label:"超时(秒)",rules:[{required:!0,message:"请输入超时时间"}],initialValue:300,children:(0,r.jsxs)(j.A,{children:[(0,r.jsx)(j.A.Option,{value:60,children:"1 分钟"}),(0,r.jsx)(j.A.Option,{value:300,children:"5 分钟"}),(0,r.jsx)(j.A.Option,{value:600,children:"10 分钟"}),(0,r.jsx)(j.A.Option,{value:1800,children:"30 分钟"}),(0,r.jsx)(j.A.Option,{value:3600,children:"60 分钟"})]})})]}),(0,r.jsxs)(n.A.Item,{label:"Python 依赖包（可选）",children:[(0,r.jsx)(p.A.TextArea,{value:J,onChange:e=>H(e.target.value),placeholder:"每行一个包，例如: requests==2.31.0 pandas>=1.5.0",rows:4}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#677489",marginTop:8},children:["支持 ==、",">=","、","<=","、",">","、~ 等版本约束符号"]})]})]})}),(0,r.jsx)(x.A,{title:"会话详情",open:B,onCancel:()=>F(!1),footer:[(0,r.jsx)(d.Ay,{onClick:()=>F(!1),children:"关闭"},"close"),(0,r.jsx)(d.Ay,{type:"primary",icon:(0,r.jsx)(S.A,{}),onClick:()=>{F(!1),P&&ea(P.id)},children:"执行代码"},"execute")],width:700,children:P&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"会话ID"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:(0,r.jsx)("code",{children:P.id})})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"模版ID"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:P.template_id})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"状态"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:ey(P.status).label})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"运行时类型"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:w.iZ[P.runtime_type]||P.runtime_type})]}),P.resource_limit&&(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"资源配置"}),(0,r.jsxs)("div",{style:{fontSize:14,marginTop:4},children:[P.resource_limit.cpu," 核 / ",P.resource_limit.memory," / ",P.resource_limit.disk]})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"超时时间"}),(0,r.jsxs)("div",{style:{fontSize:14,marginTop:4},children:[P.timeout," 秒"]})]}),P.workspace_path&&(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"工作空间"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:(0,r.jsx)("code",{style:{fontSize:12},children:P.workspace_path})})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"运行时节点"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:P.runtime_node||"-"})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"容器ID"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:(0,r.jsx)("code",{style:{fontSize:12},children:P.container_id||"-"})})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"创建时间"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:P.created_at})]}),P.completed_at&&(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{fontSize:12,color:"#677489"},children:"完成时间"}),(0,r.jsx)("div",{style:{fontSize:14,marginTop:4},children:P.completed_at})]})]})}),(0,r.jsxs)(x.A,{title:"上传文件",open:V,onOk:em,onCancel:()=>{Z(!1),er([]),et("")},confirmLoading:el,okText:"上传",cancelText:"取消",children:[(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsxs)("p",{style:{fontSize:14,marginBottom:8},children:["会话：",W]}),(0,r.jsx)("p",{style:{fontSize:12,color:"#677489",margin:0},children:"文件将上传到会话的工作空间目录"})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsxs)("label",{style:{fontSize:13,display:"block",marginBottom:8},children:["文件路径 ",(0,r.jsx)("span",{style:{color:"#8c8c8c"},children:"(可选，默认使用文件名)"})]}),(0,r.jsx)(p.A,{placeholder:"例如: data/input.csv 或 scripts/main.py",value:ee,onChange:e=>et(e.target.value),style:{width:"100%"}}),(0,r.jsx)("div",{style:{fontSize:12,color:"#677489",marginTop:8},children:"可指定文件在工作空间中的路径，留空则使用原文件名"})]}),(0,r.jsx)(A.A,{fileList:ei,onChange:e=>{let{fileList:t}=e;return er(t)},beforeUpload:()=>!1,onRemove:()=>!0,multiple:!0,children:(0,r.jsx)(d.Ay,{icon:(0,r.jsx)(g.A,{}),children:"选择文件"})})]})]})}},8371(e,t,i){i.d(t,{A:()=>n});var r=i(8909),l=i(4608);let s=r.A.create({baseURL:l.JR,timeout:3e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>e,e=>Promise.reject(e)),s.interceptors.response.use(e=>e.data,e=>{if(e.response){let{status:t,data:i}=e.response;console.error(`API Error [${t}]:`,i)}else e.request?console.error("Network Error:",e.message):console.error("Request Error:",e.message);return Promise.reject(e)});let n=s},3232(e,t,i){i.d(t,{Jt:()=>l,bE:()=>s,yH:()=>o,yJ:()=>n});var r=i(8371);function l(e,t){return r.A.get(e,t)}function s(e,t,i){return r.A.post(e,t,i)}function n(e,t,i){return r.A.put(e,t,i)}function o(e,t){return r.A.delete(e,t)}}}]);