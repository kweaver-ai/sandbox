"use strict";(self.webpackChunksandbox_web=self.webpackChunksandbox_web||[]).push([["813"],{4608(e,t,r){r.d(t,{JR:()=>s,Sn:()=>o,nS:()=>i});let s="http://localhost:8000",o={HEALTH:"/api/v1/health",HEALTH_DETAILED:"/api/v1/health/detailed",TEMPLATES:"/api/v1/templates",TEMPLATE:e=>`/api/v1/templates/${e}`,SESSIONS:"/api/v1/sessions",SESSION:e=>`/api/v1/sessions/${e}`,EXECUTE:e=>`/api/v1/executions/sessions/${e}/execute`,EXECUTION_STATUS:e=>`/api/v1/executions/${e}/status`,EXECUTION_RESULT:e=>`/api/v1/executions/${e}/result`,EXECUTIONS_BY_SESSION:e=>`/api/v1/executions/sessions/${e}/executions`,UPLOAD_FILE:e=>`/api/v1/sessions/${e}/files/upload`,DOWNLOAD_FILE:(e,t)=>`/api/v1/sessions/${e}/files/${t}`},i={LIMIT:50,OFFSET:0}},4372(e,t,r){r.d(t,{Gw:()=>o,iZ:()=>s,iu:()=>n,mx:()=>i});let s={"python3.11":"Python 3.11",nodejs20:"Node.js 20",java17:"Java 17","go1.21":"Go 1.21"},o={PENDING:"等待中",CREATING:"创建中",STARTING:"启动中",RUNNING:"运行中",COMPLETED:"已完成",TERMINATED:"已终止",FAILED:"失败",TIMEOUT:"超时"},i={PENDING:"等待中",RUNNING:"执行中",COMPLETED:"成功",FAILED:"失败",TIMEOUT:"超时",CRASHED:"崩溃"},n={CPU:["0.5","1","2","4"],MEMORY:["128Mi","256Mi","512Mi","1Gi","2Gi","4Gi","8Gi"],DISK:["256Mi","512Mi","1Gi","5Gi","10Gi","20Gi","50Gi"]}},3803(e,t,r){r.d(t,{t:()=>l});var s=r(6540),o=r(7959),i=r(4608),n=r(3232);function l(){let[e,t]=(0,s.useState)([]),[r,l]=(0,s.useState)(!1),a=(0,s.useRef)(!1),d={total:e.length,starting:e.filter(e=>"CREATING"===e.status||"creating"===e.status||"STARTING"===e.status||"starting"===e.status).length,running:e.filter(e=>"RUNNING"===e.status||"running"===e.status).length,terminated:e.filter(e=>"TERMINATED"===e.status||"terminated"===e.status||"COMPLETED"===e.status||"completed"===e.status).length},c=(0,s.useCallback)(async()=>{if(!a.current){a.current=!0,l(!0);try{let e=await (0,n.Jt)(i.Sn.SESSIONS,{params:void 0});t(e.items)}catch(e){o.Ay.error("获取会话列表失败"),console.error(e)}finally{a.current=!1,l(!1)}}},[]);return{sessions:e,stats:d,loading:r,fetchSessions:c,createSession:(0,s.useCallback)(async e=>{l(!0);try{let r=await (0,n.bE)(i.Sn.SESSIONS,e);return t(e=>[...e,r]),o.Ay.success("会话创建成功"),r}catch(e){throw o.Ay.error("会话创建失败"),console.error(e),e}finally{l(!1)}},[]),terminateSession:(0,s.useCallback)(async e=>{l(!0);try{let r=await (0,n.yH)(i.Sn.SESSION(e));return t(t=>t.map(t=>t.id===e?r:t)),o.Ay.success("会话已终止"),r}catch(e){throw o.Ay.error("会话终止失败"),console.error(e),e}finally{l(!1)}},[])}}},644(e,t,r){r.r(t),r.d(t,{default:()=>S});var s=r(4848),o=r(6540),i=r(4976),n=r(2880),l=r(697),a=r(5303),d=r(5196),c=r(3860),u=r(1579),f=r(4518),m=r(7959),g=r(4608),y=r(3232),h=r(3803),p=r(4372);let x=`def handler(event):
    name = event.get("name", "World")
    return {"message": f"Hello, {name}!"}
`,E=`{
  "name": "Sandbox Platform"
}`;function S(){let[e]=(0,i.ok)(),{sessions:t,loading:r,fetchSessions:d}=(0,h.t)(),[u,S]=(0,o.useState)(""),[N,j]=(0,o.useState)(x),[v,T]=(0,o.useState)(E),[I,A]=(0,o.useState)(""),{executions:C,currentExecution:R,loading:L,executeCode:D,fetchSessionExecutions:O}=function(){let[e,t]=(0,o.useState)([]),[r,s]=(0,o.useState)(!1),[i,n]=(0,o.useState)(null),l=(0,o.useCallback)(async(e,t)=>{s(!0);try{let r=await (0,y.bE)(g.Sn.EXECUTE(e),t);return a(r.execution_id),r}catch(e){throw m.Ay.error("代码执行提交失败"),console.error(e),e}finally{s(!1)}},[]),a=(0,o.useCallback)(async e=>{let r=0,s=async()=>{r++;try{let o=await (0,y.Jt)(g.Sn.EXECUTION_RESULT(e));n(o),"pending"===o.status||"PENDING"===o.status||"running"===o.status||"RUNNING"===o.status?r<60&&setTimeout(s,1e3):(t(e=>e.some(e=>e.id===o.id)?e:[o,...e]),setTimeout(()=>n(null),100),"completed"===o.status||"COMPLETED"===o.status?m.Ay.success("代码执行成功"):"failed"===o.status?m.Ay.error("代码执行失败"):"timeout"===o.status&&m.Ay.error("代码执行超时"))}catch(e){console.error("获取执行结果失败",e),r<60&&setTimeout(s,1e3)}};s()},[]);return{executions:e,currentExecution:i,loading:r,executeCode:l,fetchSessionExecutions:(0,o.useCallback)(async e=>{s(!0);try{let r=await (0,y.Jt)(g.Sn.EXECUTIONS_BY_SESSION(e),{params:{...g.nS,...void 0}});t(r.items)}catch(e){m.Ay.error("获取执行历史失败"),console.error(e)}finally{s(!1)}},[]),clearCurrentExecution:(0,o.useCallback)(()=>{n(null)},[])}}();(0,o.useEffect)(()=>{d()},[d]),(0,o.useEffect)(()=>{let r=e.get("sessionId");if(r)S(r);else if(t.length>0){let e=t.filter(e=>"terminated"!==e.status&&"TERMINATED"!==e.status);if(e.length>0){let t=e.find(e=>"running"===e.status||"RUNNING"===e.status);S((null==t?void 0:t.id)||e[0].id)}}},[e,t]),(0,o.useEffect)(()=>{u&&O(u)},[u,O]);let G=async()=>{try{JSON.parse(v),A("")}catch{A("Event 数据必须是有效的 JSON 格式");return}let e={code:N,language:"python",event:JSON.parse(v),timeout:30};await D(u,e)},w=e=>{let t={PENDING:{color:"warning",icon:"⏱",label:p.mx.PENDING},RUNNING:{color:"processing",icon:"⚡",label:p.mx.RUNNING},COMPLETED:{color:"success",icon:"✓",label:p.mx.COMPLETED},FAILED:{color:"error",icon:"✗",label:p.mx.FAILED},TIMEOUT:{color:"error",icon:"⏱",label:p.mx.TIMEOUT},CRASHED:{color:"error",icon:"\uD83D\uDCA5",label:p.mx.CRASHED},pending:{color:"warning",icon:"⏱",label:p.mx.PENDING},running:{color:"processing",icon:"⚡",label:p.mx.RUNNING},completed:{color:"success",icon:"✓",label:p.mx.COMPLETED},failed:{color:"error",icon:"✗",label:p.mx.FAILED},timeout:{color:"error",icon:"⏱",label:p.mx.TIMEOUT},crashed:{color:"error",icon:"\uD83D\uDCA5",label:p.mx.CRASHED}};return t[e]||t.PENDING};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{marginBottom:24},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,s.jsx)("div",{style:{width:2,height:18,backgroundColor:"#126ee3",borderRadius:4,marginRight:8}}),(0,s.jsx)("h2",{style:{fontSize:15,fontWeight:500,margin:0,color:"#000000"},children:"代码执行"})]}),(0,s.jsx)("p",{style:{fontSize:13,color:"#677489",marginLeft:12,marginTop:0,marginBottom:0},children:"在选定的会话中执行 Python 代码"})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:24},children:[(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:(0,s.jsxs)("div",{style:{backgroundColor:"#ffffff",borderRadius:12,border:"1px solid #e7edf7",padding:24},children:[(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("label",{style:{display:"block",fontSize:14,color:"rgba(0,0,0,0.85)",marginBottom:8},children:"选择会话"}),(0,s.jsx)(n.A,{value:u,onChange:S,style:{width:"100%"},loading:r,placeholder:"请选择会话",children:t.filter(e=>"terminated"!==e.status&&"TERMINATED"!==e.status).map(e=>(0,s.jsxs)(n.A.Option,{value:e.id,children:[e.id," (",e.runtime_type,") - ",e.status]},e.id))})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("label",{style:{display:"block",fontSize:14,color:"rgba(0,0,0,0.85)",marginBottom:8},children:"Python 代码 (Lambda Handler 格式)"}),(0,s.jsx)("div",{style:{border:"1px solid #d9d9d9",borderRadius:4,overflow:"hidden"},children:(0,s.jsx)(f.Ay,{height:280,defaultLanguage:"python",value:N,onChange:e=>j(e||""),theme:"vs-light",options:{minimap:{enabled:!1},fontSize:13,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("label",{style:{display:"block",fontSize:14,color:"rgba(0,0,0,0.85)",marginBottom:8},children:"Event 数据 (JSON)"}),(0,s.jsx)("div",{style:{border:"1px solid #d9d9d9",borderRadius:4,overflow:"hidden"},children:(0,s.jsx)(f.Ay,{height:120,defaultLanguage:"json",value:v,onChange:e=>T(e||""),theme:"vs-light",options:{minimap:{enabled:!1},fontSize:13,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),I&&(0,s.jsx)("div",{style:{color:"#ff4d4f",fontSize:12,marginTop:4},children:I})]}),(0,s.jsx)(l.Ay,{type:"primary",icon:(0,s.jsx)(c.A,{}),onClick:G,disabled:L,size:"large",style:{width:"100%"},children:L?"执行中...":"执行代码"})]})}),(0,s.jsxs)("div",{style:{backgroundColor:"#ffffff",borderRadius:12,border:"1px solid #e7edf7",padding:24},children:[(0,s.jsx)("h3",{style:{fontSize:15,fontWeight:500,marginTop:0,marginBottom:16,color:"#000000"},children:"执行历史"}),(0,s.jsx)("div",{style:{maxHeight:600,overflowY:"auto"},children:0!==C.length||R?(0,s.jsxs)(s.Fragment,{children:[R&&(0,s.jsx)(b,{execution:R,getStatusConfig:w}),C.map(e=>(0,s.jsx)(b,{execution:e,getStatusConfig:w},e.id))]}):(0,s.jsx)(a.A,{image:a.A.PRESENTED_IMAGE_SIMPLE,description:"暂无执行记录",style:{padding:"40px 0"}})})]})]})]})}function b(e){let{execution:t,getStatusConfig:r}=e,[i,n]=(0,o.useState)(!1),l=r(t.status);return(0,s.jsxs)("div",{style:{border:"1px solid #e7edf7",borderRadius:8,padding:16,marginBottom:12,transition:"border-color 0.2s"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,s.jsx)("span",{style:{fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.85)"},children:t.id}),(0,s.jsxs)(d.A,{color:l.color,children:[l.icon," ",l.label]})]}),(0,s.jsx)("p",{style:{fontSize:12,color:"#677489",margin:0},children:t.created_at})]}),t.execution_time&&(0,s.jsxs)("div",{style:{textAlign:"right"},children:[(0,s.jsx)("p",{style:{fontSize:12,color:"#677489",margin:0},children:"耗时"}),(0,s.jsxs)("p",{style:{fontSize:13,fontWeight:500,color:"rgba(0,0,0,0.85)",margin:0},children:[(1e3*t.execution_time).toFixed(0),"ms"]})]})]}),("COMPLETED"===t.status||"completed"===t.status)&&t.return_value&&(0,s.jsxs)("div",{style:{marginBottom:8},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[(0,s.jsx)(u.A,{style:{fontSize:12,color:"#52c41a"}}),(0,s.jsx)("p",{style:{fontSize:12,fontWeight:500,color:"rgba(0,0,0,0.85)",margin:0},children:"返回值"})]}),(0,s.jsx)("pre",{style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:4,padding:8,fontSize:11,fontFamily:"monospace",overflow:"auto",margin:0},children:JSON.stringify(t.return_value,null,2)})]}),t.stdout&&(0,s.jsxs)("div",{style:{marginBottom:8},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[(0,s.jsx)(u.A,{style:{fontSize:12,color:"#1890ff"}}),(0,s.jsx)("p",{style:{fontSize:12,fontWeight:500,color:"rgba(0,0,0,0.85)",margin:0},children:"标准输出"})]}),(0,s.jsx)("pre",{style:{backgroundColor:"#fafafa",border:"1px solid #e7edf7",borderRadius:4,padding:8,fontSize:11,fontFamily:"monospace",overflow:"auto",margin:0},children:t.stdout})]}),t.stderr&&(0,s.jsxs)("div",{style:{marginBottom:8},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:4},children:[(0,s.jsx)(u.A,{style:{fontSize:12,color:"#ff4d4f"}}),(0,s.jsx)("p",{style:{fontSize:12,fontWeight:500,color:"rgba(0,0,0,0.85)",margin:0},children:"错误信息"})]}),(0,s.jsx)("pre",{style:{backgroundColor:"#fff1f0",border:"1px solid #ffccc7",borderRadius:4,padding:8,fontSize:11,fontFamily:"monospace",overflow:"auto",color:"#ff4d4f",margin:0},children:t.stderr})]}),(0,s.jsxs)("details",{style:{marginTop:8},children:[(0,s.jsx)("summary",{style:{fontSize:12,color:"#126ee3",cursor:"pointer",userSelect:"none"},children:"查看代码"}),(0,s.jsx)("pre",{style:{marginTop:8,backgroundColor:"#fafafa",border:"1px solid #e7edf7",borderRadius:4,padding:8,fontSize:11,fontFamily:"monospace",overflow:"auto",margin:0},children:t.code})]})]},t.id)}},8371(e,t,r){r.d(t,{A:()=>n});var s=r(8909),o=r(4608);let i=s.A.create({baseURL:o.JR,timeout:3e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>e,e=>Promise.reject(e)),i.interceptors.response.use(e=>e.data,e=>{if(e.response){let{status:t,data:r}=e.response;console.error(`API Error [${t}]:`,r)}else e.request?console.error("Network Error:",e.message):console.error("Request Error:",e.message);return Promise.reject(e)});let n=i},3232(e,t,r){r.d(t,{Jt:()=>o,bE:()=>i,yH:()=>l,yJ:()=>n});var s=r(8371);function o(e,t){return s.A.get(e,t)}function i(e,t,r){return s.A.post(e,t,r)}function n(e,t,r){return s.A.put(e,t,r)}function l(e,t){return s.A.delete(e,t)}}}]);