"use strict";(self.webpackChunksandbox_web=self.webpackChunksandbox_web||[]).push([["297"],{4608(e,t,r){r.d(t,{JR:()=>l,Sn:()=>i,nS:()=>s});let l="http://localhost:8000",i={HEALTH:"/api/v1/health",HEALTH_DETAILED:"/api/v1/health/detailed",TEMPLATES:"/api/v1/templates",TEMPLATE:e=>`/api/v1/templates/${e}`,SESSIONS:"/api/v1/sessions",SESSION:e=>`/api/v1/sessions/${e}`,EXECUTE:e=>`/api/v1/executions/sessions/${e}/execute`,EXECUTION_STATUS:e=>`/api/v1/executions/${e}/status`,EXECUTION_RESULT:e=>`/api/v1/executions/${e}/result`,EXECUTIONS_BY_SESSION:e=>`/api/v1/executions/sessions/${e}/executions`,UPLOAD_FILE:e=>`/api/v1/sessions/${e}/files/upload`,DOWNLOAD_FILE:(e,t)=>`/api/v1/sessions/${e}/files/${t}`},s={LIMIT:50,OFFSET:0}},4372(e,t,r){r.d(t,{Gw:()=>i,iZ:()=>l,iu:()=>a,mx:()=>s});let l={"python3.11":"Python 3.11",nodejs20:"Node.js 20",java17:"Java 17","go1.21":"Go 1.21"},i={PENDING:"等待中",STARTING:"启动中",RUNNING:"运行中",COMPLETED:"已完成",FAILED:"失败",TIMEOUT:"超时"},s={PENDING:"等待中",RUNNING:"执行中",COMPLETED:"成功",FAILED:"失败",TIMEOUT:"超时",CRASHED:"崩溃"},a={CPU:["0.5","1","2","4"],MEMORY:["128Mi","256Mi","512Mi","1Gi","2Gi","4Gi","8Gi"],DISK:["256Mi","512Mi","1Gi","5Gi","10Gi","20Gi","50Gi"]}},350(e,t,r){r.d(t,{b:()=>n});var l=r(6540),i=r(7959),s=r(4608),a=r(1643);function n(){let[e,t]=(0,l.useState)([]),[r,n]=(0,l.useState)(!1),o=(0,l.useCallback)(async()=>{n(!0);try{let e=await (0,a.Jt)(s.Sn.TEMPLATES,{params:{...s.nS,...void 0}});t(e)}catch(e){i.Ay.error("获取模板列表失败"),console.error(e)}finally{n(!1)}},[]),c=(0,l.useCallback)(async e=>{n(!0);try{let r=await (0,a.bE)(s.Sn.TEMPLATES,e);return t(e=>[...e,r]),i.Ay.success("模板创建成功"),r}catch(e){throw i.Ay.error("模板创建失败"),console.error(e),e}finally{n(!1)}},[]);return{templates:e,loading:r,fetchTemplates:o,createTemplate:c,updateTemplate:(0,l.useCallback)(async(e,r)=>{n(!0);try{let l=await (0,a.yJ)(s.Sn.TEMPLATE(e),r);return t(t=>t.map(t=>t.id===e?l:t)),i.Ay.success("模板更新成功"),l}catch(e){throw i.Ay.error("模板更新失败"),console.error(e),e}finally{n(!1)}},[]),deleteTemplate:(0,l.useCallback)(async e=>{n(!0);try{await (0,a.yH)(s.Sn.TEMPLATE(e)),t(t=>t.filter(t=>t.id!==e)),i.Ay.success("模板删除成功")}catch(e){throw i.Ay.error("模板删除失败"),console.error(e),e}finally{n(!1)}},[])}}},200(e,t,r){r.r(t),r.d(t,{default:()=>b});var l=r(4848),i=r(6540),s=r(3543),a=r(5196),n=r(3133),o=r(697),c=r(7073),d=r(9405),u=r(7486),p=r(2402),y=r(3852),h=r(5801),x=r(6040),m=r(8237),A=r(7710),E=r(6029),S=r(4811),f=r(8623),j=r(7959),T=r(4608),g=r(1643),I=r(350),v=r(4372);function b(){let{sessions:e,stats:t,loading:r,fetchSessions:b,createSession:w,terminateSession:C}=function(){let[e,t]=(0,i.useState)([]),[r,l]=(0,i.useState)(!1),s={total:e.length,running:e.filter(e=>"RUNNING"===e.status).length,completed:e.filter(e=>"COMPLETED"===e.status).length,failed:e.filter(e=>"FAILED"===e.status).length},a=(0,i.useCallback)(async()=>{l(!0);try{let e=await (0,g.Jt)(T.Sn.SESSIONS);t(e)}catch(e){j.Ay.error("获取会话列表失败"),console.error(e)}finally{l(!1)}},[]);return{sessions:e,stats:s,loading:r,fetchSessions:a,createSession:(0,i.useCallback)(async e=>{l(!0);try{let r=await (0,g.bE)(T.Sn.SESSIONS,e);return t(e=>[...e,r]),j.Ay.success("会话创建成功"),r}catch(e){throw j.Ay.error("会话创建失败"),console.error(e),e}finally{l(!1)}},[]),terminateSession:(0,i.useCallback)(async e=>{l(!0);try{let r=await (0,g.yH)(T.Sn.SESSION(e));return t(t=>t.map(t=>t.id===e?r:t)),j.Ay.success("会话已终止"),r}catch(e){throw j.Ay.error("会话终止失败"),console.error(e),e}finally{l(!1)}},[])}}(),{templates:N,fetchTemplates:O}=(0,I.b)(),[G,L]=(0,i.useState)(""),[k,D]=(0,i.useState)(!1),[M,P]=(0,i.useState)([]),[R,_]=(0,i.useState)(""),[U]=s.A.useForm();(0,i.useEffect)(()=>{b()},[b]);let F=async()=>{await O(),D(!0)},$=e.filter(e=>e.id.toLowerCase().includes(G.toLowerCase())||e.template_id.toLowerCase().includes(G.toLowerCase())),q=async()=>{try{let e={...await U.validateFields(),dependencies:R.split("\n").filter(e=>e.trim()).map(e=>{var t,r;let l=e.trim().split(/==|>=|<=|>|~/),i=null==(t=l[0])?void 0:t.trim(),s=null==(r=l[1])?void 0:r.trim();return{name:i,version:s}}).filter(e=>e.name)};await w(e),D(!1),U.resetFields(),_(""),P([])}catch(e){}},z=async e=>{try{await C(e)}catch(e){}},H=[{title:"会话ID",dataIndex:"id",key:"id",width:180,render:e=>(0,l.jsx)("code",{children:e})},{title:"模版ID",dataIndex:"template_id",key:"template_id",width:180},{title:"状态",dataIndex:"status",key:"status",width:120,render:e=>{let t,r=(t={PENDING:{color:"warning",icon:"⏱",label:v.Gw.PENDING},STARTING:{color:"processing",icon:"\uD83D\uDD04",label:v.Gw.STARTING},RUNNING:{color:"processing",icon:"⚡",label:v.Gw.RUNNING},COMPLETED:{color:"success",icon:"✓",label:v.Gw.COMPLETED},FAILED:{color:"error",icon:"✗",label:v.Gw.FAILED},TIMEOUT:{color:"error",icon:"⏱",label:v.Gw.TIMEOUT}})[e]||t.PENDING;return(0,l.jsxs)(a.A,{color:r.color,children:[r.icon," ",r.label]})}},{title:"资源配置",key:"resources",width:200,render:(e,t)=>t.resource_limit?`${t.resource_limit.cpu}核 / ${t.resource_limit.memory} / ${t.resource_limit.disk}`:"-"},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:180},{title:"操作",key:"action",width:150,fixed:"right",render:(e,t)=>(0,l.jsxs)(n.A,{size:"small",children:[(0,l.jsx)(o.Ay,{type:"text",icon:(0,l.jsx)(m.A,{}),size:"small",title:"上传文件",onClick:()=>{}}),(0,l.jsx)(o.Ay,{type:"text",icon:(0,l.jsx)(A.A,{}),size:"small",title:"下载文件",onClick:()=>{}}),(0,l.jsx)(c.A,{title:"确认终止",description:"确定要终止该会话吗？",onConfirm:()=>z(t.id),okText:"确定",cancelText:"取消",children:(0,l.jsx)(o.Ay,{type:"text",danger:!0,icon:(0,l.jsx)(E.A,{}),size:"small",disabled:"COMPLETED"===t.status})})]})}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,l.jsx)("div",{style:{width:2,height:18,backgroundColor:"#126ee3",borderRadius:4,marginRight:8}}),(0,l.jsx)("h2",{style:{fontSize:15,fontWeight:500,margin:0,color:"#000000"},children:"会话管理"})]}),(0,l.jsx)("p",{style:{fontSize:13,color:"#677489",marginLeft:12,marginTop:0,marginBottom:0},children:"创建和管理代码执行会话"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:24},children:[(0,l.jsx)(d.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,l.jsx)(u.A,{title:"总会话数（个）",value:t.total})}),(0,l.jsx)(d.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,l.jsx)(u.A,{title:"运行中（个）",value:t.running,valueStyle:{color:"#126ee3"}})}),(0,l.jsx)(d.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,l.jsx)(u.A,{title:"已完成（个）",value:t.completed,valueStyle:{color:"#52c41a"}})}),(0,l.jsx)(d.A,{style:{flex:1,borderRadius:12,border:"1px solid #e7edf7"},bodyStyle:{padding:24},children:(0,l.jsx)(u.A,{title:"失败（个）",value:t.failed,valueStyle:{color:"#ff4d4f"}})})]}),(0,l.jsxs)("div",{style:{backgroundColor:"#ffffff",borderRadius:12,border:"1px solid #e7edf7",padding:24},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24},children:[(0,l.jsx)(p.A,{placeholder:"搜索会话ID或模版ID",prefix:(0,l.jsx)(S.A,{}),value:G,onChange:e=>L(e.target.value),style:{width:320},allowClear:!0}),(0,l.jsx)(o.Ay,{type:"primary",icon:(0,l.jsx)(f.A,{}),onClick:F,children:"创建会话"})]}),(0,l.jsx)(y.A,{columns:H,dataSource:$,rowKey:"id",loading:r,pagination:{pageSize:10},scroll:{x:1200}})]}),(0,l.jsx)(h.A,{title:"创建新会话",open:k,onOk:q,onCancel:()=>{D(!1),U.resetFields(),_(""),P([])},width:600,okText:"创建",cancelText:"取消",children:(0,l.jsxs)(s.A,{form:U,layout:"vertical",style:{marginTop:24},children:[(0,l.jsx)(s.A.Item,{name:"template_id",label:"选择模版",rules:[{required:!0,message:"请选择模版"}],children:(0,l.jsx)(x.A,{placeholder:"请选择模版",children:N.filter(e=>e.is_active).map(e=>(0,l.jsxs)(x.A.Option,{value:e.id,children:[e.name," (",v.iZ[e.runtime_type]||e.runtime_type,")"]},e.id))})}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,l.jsx)(s.A.Item,{name:"cpu",label:"CPU",rules:[{required:!0,message:"请输入CPU"}],initialValue:"1",children:(0,l.jsx)(x.A,{placeholder:"例如: 1, 2",children:v.iu.CPU.map(e=>(0,l.jsxs)(x.A.Option,{value:e,children:[e," 核"]},e))})}),(0,l.jsx)(s.A.Item,{name:"memory",label:"内存",rules:[{required:!0,message:"请输入内存"}],initialValue:"512Mi",children:(0,l.jsx)(x.A,{placeholder:"例如: 512Mi, 1Gi",children:v.iu.MEMORY.map(e=>(0,l.jsx)(x.A.Option,{value:e,children:e},e))})}),(0,l.jsx)(s.A.Item,{name:"disk",label:"磁盘",rules:[{required:!0,message:"请输入磁盘"}],initialValue:"1Gi",children:(0,l.jsx)(x.A,{placeholder:"例如: 1Gi, 10Gi",children:v.iu.DISK.map(e=>(0,l.jsx)(x.A.Option,{value:e,children:e},e))})}),(0,l.jsx)(s.A.Item,{name:"timeout",label:"超时(秒)",rules:[{required:!0,message:"请输入超时时间"}],initialValue:300,children:(0,l.jsxs)(x.A,{children:[(0,l.jsx)(x.A.Option,{value:60,children:"1 分钟"}),(0,l.jsx)(x.A.Option,{value:300,children:"5 分钟"}),(0,l.jsx)(x.A.Option,{value:600,children:"10 分钟"}),(0,l.jsx)(x.A.Option,{value:1800,children:"30 分钟"}),(0,l.jsx)(x.A.Option,{value:3600,children:"60 分钟"})]})})]}),(0,l.jsxs)(s.A.Item,{label:"Python 依赖包（可选）",children:[(0,l.jsx)(p.A.TextArea,{value:R,onChange:e=>_(e.target.value),placeholder:"每行一个包，例如: requests==2.31.0 pandas>=1.5.0",rows:4}),(0,l.jsxs)("div",{style:{fontSize:12,color:"#677489",marginTop:8},children:["支持 ==、",">=","、","<=","、",">","、~ 等版本约束符号"]})]})]})})]})}},1643(e,t,r){r.d(t,{Jt:()=>a,bE:()=>n,yJ:()=>o,yH:()=>c});var l=r(8909),i=r(4608);let s=l.A.create({baseURL:i.JR,timeout:3e4,headers:{"Content-Type":"application/json"}});function a(e,t){return s.get(e,t)}function n(e,t,r){return s.post(e,t,r)}function o(e,t,r){return s.put(e,t,r)}function c(e,t){return s.delete(e,t)}s.interceptors.request.use(e=>e,e=>Promise.reject(e)),s.interceptors.response.use(e=>e.data,e=>{if(e.response){let{status:t,data:r}=e.response;console.error(`API Error [${t}]:`,r)}else e.request?console.error("Network Error:",e.message):console.error("Request Error:",e.message);return Promise.reject(e)})}}]);