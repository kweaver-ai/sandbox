{{- if .Values.configMap.create }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.configMap.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ include "sandbox.fullname" . }}
data:
  ENVIRONMENT: {{ .Values.controlPlane.env.ENVIRONMENT | quote }}
  DEBUG: {{ .Values.controlPlane.env.DEBUG | quote }}
  DATABASE_URL: {{ .Values.controlPlane.env.DATABASE_URL | quote }}
  KUBERNETES_NAMESPACE: {{ .Values.namespace | quote }}
  DEFAULT_TIMEOUT: {{ .Values.controlPlane.env.DEFAULT_TIMEOUT | quote }}
  MAX_TIMEOUT: {{ .Values.controlPlane.env.MAX_TIMEOUT | quote }}
  DEFAULT_CPU: {{ .Values.controlPlane.env.DEFAULT_CPU | quote }}
  DEFAULT_MEMORY: {{ .Values.controlPlane.env.DEFAULT_MEMORY | quote }}
  DEFAULT_DISK: {{ .Values.controlPlane.env.DEFAULT_DISK | quote }}
  IDLE_THRESHOLD_MINUTES: {{ .Values.controlPlane.env.IDLE_THRESHOLD_MINUTES | quote }}
  MAX_LIFETIME_HOURS: {{ .Values.controlPlane.env.MAX_LIFETIME_HOURS | quote }}
  CLEANUP_INTERVAL_SECONDS: {{ .Values.controlPlane.env.CLEANUP_INTERVAL_SECONDS | quote }}
  DISABLE_BWRAP: {{ .Values.controlPlane.env.DISABLE_BWRAP | quote }}
  PYTHONUNBUFFERED: {{ .Values.controlPlane.env.PYTHONUNBUFFERED | quote }}
  DEFAULT_TEMPLATE_IMAGE: "{{- if .Values.controlPlane.defaultTemplate.image.registry }}{{ .Values.controlPlane.defaultTemplate.image.registry }}/{{ end }}{{ .Values.controlPlane.defaultTemplate.image.repository }}:{{ .Values.controlPlane.defaultTemplate.image.tag }}"
  # Database connection from depServices.rds
  {{- if .Values.depServices.rds }}
  DB_TYPE: {{ .Values.depServices.rds.type | quote }}
  DB_HOST: {{ .Values.depServices.rds.host | quote }}
  DB_PORT: {{ .Values.depServices.rds.port | quote }}
  DB_HOST_READ: {{ .Values.depServices.rds.hostRead | quote }}
  DB_PORT_READ: {{ .Values.depServices.rds.portRead | quote }}
  DB_USER: {{ .Values.depServices.rds.user | quote }}
  DB_PASSWORD: {{ .Values.depServices.rds.password | quote }}
  DB_DATABASE: {{ .Values.depServices.rds.database | quote }}
  DB_MAX_CONNECTIONS: {{ .Values.depServices.rds.maxConnections | quote }}
  DB_MAX_READ_CONNECTIONS: {{ .Values.depServices.rds.maxReadConnections | quote }}
  DB_CHARSET: {{ .Values.depServices.rds.dbCharset | quote }}
  DB_TIMEOUT: {{ .Values.depServices.rds.timeout | quote }}
  DB_READ_TIMEOUT: {{ .Values.depServices.rds.readTimeout | quote }}
  DB_WRITE_TIMEOUT: {{ .Values.depServices.rds.writeTimeout | quote }}
  {{- end }}
{{- end }}
